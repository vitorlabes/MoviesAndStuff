<div class="container-fluid py-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-start mb-4">
    <h2 class="form-title mb-0">
      <i class="bi" [ngClass]="config.icon"></i> {{ config.collectionName }}
    </h2>

    <button class="btn btn-dark-purple" (click)="navigateToNew()">
      <i class="bi bi-plus-lg"></i> Add {{ config.singularName }}
    </button>
  </div>

  <!-- Search bar -->
  <div class="row align-items-center mb-3">
    <div class="col-md-8 col-sm-12">
      <input class="form-control text-light search-input" [placeholder]="config.searchPlaceholder"
        [formControl]="searchControl">
    </div>

    <div class="col-md-4 col-sm-12">
      <app-dropdown [options]="genres()" placeholder="Select genre..." [searchable]="true"
        [selectedValue]="selectedGenre()" (selectionChange)="onGenreSelected($event)">
      </app-dropdown>
    </div>
  </div>

  <!-- Status filter -->
  <div class="filter-toggle-group my-3 d-flex justify-content-center gap-2">
    @for (option of config.filterOptions; track option.value) {
    <button type="button" class="toggle-btn" [class.active]="selectedFilter() === option.value"
      (click)="setFilter(option.value)">
      <i class="bi" [ngClass]="option.icon"></i> {{ option.label }}
    </button>
    }
  </div>

  <!-- Loading -->
  @if(isLoading()) {
  <div class="d-flex justify-content-center align-items-center py-5">
    <div class="text-center">
      <div class="spinner-border text-light mb-3" role="status" style="width: 3rem; height: 3rem;">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="text-light">{{ config.loadingMessage }}</p>
    </div>
  </div>
  }

  @if(!isLoading()) {
  <!-- No result on list -->
  @if(showEmptySearch()) {
  <div class="empty-state">
    <i class="bi bi-search"></i>
    <p>No results found for "{{ currentSearch() }}"</p>
  </div>
  }

  <!-- Table -->
  @if(hasResults()) {
  <div class="cinematic-table-container">
    <table class="table table-cinematic table-hover">
      <thead class="table-header-glow">
        <tr>
          <th class="ps-4">Title</th>
          <th>Genre</th>
          <th>Status</th>
          @if(config.showDateColumn) {
          <th>{{ config.dateColumnLabel }}</th>
          }
          <th class="pe-4"></th>
        </tr>
      </thead>
      <tbody>
        @for (item of items(); track item.id) {
        <tr class="movie-row">

          <td class="ps-4 fw-bold">{{ item.title }}</td>

          <td>
            <span class="genre-badge fw-bold">{{ item.genreName || 'N/A' }}</span>
          </td>

          <!-- Status -->
          <td class="text-center align-middle">
            <div class="play-status" [class.watched]="getItemStatus(item)" [class.unwatched]="!getItemStatus(item)"
              (click)="toggleStatus(item)" style="cursor: pointer;"
              [title]="'Toggle ' + (getItemStatus(item) ? config.statusLabel.inactive : config.statusLabel.active)">
              <i class="bi play-icon" [class.bi-play-circle-fill]="getItemStatus(item)"
                [class.bi-play-circle]="!getItemStatus(item)">
              </i>
              <span class="status-text">
                {{ getItemStatus(item) ? config.statusLabel.active : config.statusLabel.inactive }}
              </span>
            </div>
          </td>

          <!-- Data (watchDate || playDate) -->
          @if(config.showDateColumn) {
          <td class="pe-4 fw-bold">
            {{ getItemDate(item) | date:'dd/MM/yyyy' }}
          </td>
          }

          <!-- Actions -->
          <td class="pe-4">
            <div class="action-buttons">
              <button class="action-btn edit-btn" [title]="'Edit ' + config.singularName"
                (click)="navigateToEdit(item.id)">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="action-btn delete-btn" [title]="'Delete ' + config.singularName"
                (click)="openDeleteModal(item.id)">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </td>

        </tr>
        }
      </tbody>
    </table>
  </div>
  }

  <!-- Empty state -->
  @if(showEmptyState()) {
  <div class="empty-state">
    <i class="bi" [ngClass]="config.icon"></i>
    <p>{{ config.emptyStateMessage }}</p>
  </div>
  }
  }
</div>

<!-- Confirm modal -->
<app-confirm-modal #confirmModal (confirm)="confirmDelete()"></app-confirm-modal>