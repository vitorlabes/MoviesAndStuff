<div class="container-fluid py-4">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-start mb-4">
    <h2 class="form-title mb-0">
      <i [class]="config.icon"></i> {{ config.collectionName }}
    </h2>

    <button class="btn btn-dark-purple" (click)="navigateToNew()">
      <i class="ri-add-line"></i> Add {{ config.singularName }}
    </button>
  </div>

  <!-- Search bar -->
  <div class="row align-items-center mb-3 g-2">
    <div class="col-md-8">
      <input class="form-control text-light search-input" [placeholder]="config.searchPlaceholder"
        [formControl]="searchControl">
    </div>

    <div class="col-md-4">
      <app-dropdown [options]="genres()" placeholder="Select genre..." [searchable]="true"
        [selectedValue]="selectedGenre()" (selectionChange)="onGenreSelected($event)">
      </app-dropdown>
    </div>
  </div>

  <!-- Status filter -->
  <div class="filter-toggle-group my-3 d-flex justify-content-center gap-2 flex-wrap">
    @for (option of config.filterOptions; track option.value) {
    <button type="button" class="toggle-btn" [class.active]="selectedFilter() === option.value"
      (click)="setFilter(option.value)">
      <i [class]="option.icon"></i> {{ option.label }}
    </button>
    }
  </div>

  <!-- Loading -->
  @if(isLoading()) {
  <div class="d-flex justify-content-center align-items-center py-5">
    <div class="text-center">
      <div class="spinner-border text-light mb-3" role="status" style="width: 3rem; height: 3rem;">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="text-light">{{ config.loadingMessage }}</p>
    </div>
  </div>
  }

  @if(!isLoading()) {
  <!-- No result on list -->
  @if(showEmptySearch()) {
  <div class="empty-state">
    <i class="ri-search-line"></i>
    <p>No results found for "{{ currentSearch() }}"</p>
  </div>
  }

  <!-- Table -->
  @if(hasResults()) {
  <app-media-table [items]="items()" [isLoading]="false">

    <!-- Title Column -->
    <ng-template appTableColumn header="Title" width="20%" headerClass="ps-4" cellClass="ps-4" let-item>
      <span class="fw-bold">{{ item.title }}</span>
    </ng-template>

    <!-- Genre Column -->
    <ng-template appTableColumn header="Genre" width="20%" headerClass="text-center" cellClass="text-center" let-item>
      <span class="genre-badge">{{ item.genreName || 'N/A' }}</span>
    </ng-template>

    <!-- Status Column -->
    <ng-template appTableColumn header="Status" width="20%" headerClass="text-center" cellClass="text-center" let-item>
      <div class="play-status mx-auto" [class.watched]="getItemStatus(item)" [class.unwatched]="!getItemStatus(item)"
        (click)="toggleStatus(item); $event.stopPropagation()" role="button" tabindex="0"
        [attr.aria-label]="'Toggle ' + (getItemStatus(item) ? config.statusLabel.inactive : config.statusLabel.active)">
        <i class="play-icon" [class.ri-play-circle-fill]="getItemStatus(item)"
          [class.ri-play-circle-line]="!getItemStatus(item)">
        </i>
        <span class="status-text">
          {{ getItemStatus(item) ? config.statusLabel.active : config.statusLabel.inactive }}
        </span>
      </div>
    </ng-template>

    <!-- Date Column -->
    @if(config.showDateColumn) {
    <ng-template appTableColumn [header]="config.dateColumnLabel || 'Date'" width="20%" headerClass="text-end pe-4"
      cellClass="text-end pe-4" let-item>
      <span class="fw-bold">{{ getItemDate(item) | date:'dd/MM/yyyy' }}</span>
    </ng-template>
    }

    <!-- Actions Column -->
    <ng-template appTableColumn header="" width="20%" headerClass="text-end pe-4" cellClass="text-end pe-4" let-item>
      <div class="action-buttons">
        <button class="action-btn edit-btn" [attr.aria-label]="'Edit ' + config.singularName"
          (click)="navigateToEdit(item.id); $event.stopPropagation()">
          <i class="ri-pencil-line"></i>
        </button>
        <button class="action-btn delete-btn" [attr.aria-label]="'Delete ' + config.singularName"
          (click)="openDeleteModal(item.id); $event.stopPropagation()">
          <i class="ri-delete-bin-line"></i>
        </button>
      </div>
    </ng-template>

  </app-media-table>
  }

  <!-- Empty state -->
  @if(showEmptyState()) {
  <div class="empty-state">
    <i [class]="config.icon"></i>
    <p>{{ config.emptyStateMessage }}</p>
  </div>
  }
  }
</div>

<app-confirm-modal #confirmModal (confirm)="confirmDelete()"></app-confirm-modal>