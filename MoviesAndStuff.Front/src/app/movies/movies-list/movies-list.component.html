<div class="container-fluid py-4">

  <div class="d-flex justify-content-between align-items-start mb-4">
    <h2 class="form-title mb-0">
      <i class="bi bi-film"></i> Movie Collection
    </h2>

    <button class="btn btn-dark-purple" (click)="navigateToNew()">
      <i class="bi bi-plus-lg"></i> Add Movie
    </button>
  </div>

  <div class="row align-items-center mb-3">
    <div class="col-md-8 col-sm-12">
      <input class="form-control text-light search-input" placeholder="Search movie by title..."
        [formControl]="searchControl">
    </div>

    <div class="col-md-4 col-sm-12">
      <app-dropdown [options]="genres()" placeholder="Select genre..." [searchable]="true"
        [selectedValue]="selectedGenre()" (selectionChange)="onGenreSelected($event)">
      </app-dropdown>
    </div>
  </div>

  <div class="filter-toggle-group my-3 d-flex justify-content-center gap-2">
    @for (option of watchFilterOptions; track option.value) {
    <button type="button" class="toggle-btn" [class.active]="selectedFilter() === option.value"
      (click)="setWatchFilter(option.value)">
      <i class="bi" [ngClass]="option.icon"></i> {{ option.label }}
    </button>
    }
  </div>

  @if(isLoading()) {
  <div class="d-flex justify-content-center align-items-center py-5">
    <div class="text-center">
      <div class="spinner-border text-light mb-3" role="status" style="width: 3rem; height: 3rem;">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="text-light">Loading movies...</p>
    </div>
  </div>
  }

  @if(!isLoading()) {
  @if(showEmptySearch()) {
  <div class="empty-state">
    <i class="bi bi-search"></i>
    <p>No results found for "{{ currentSearch() }}"</p>
  </div>
  }

  @if(hasResults()) {
  <div class="cinematic-table-container">
    <table class="table table-cinematic table-hover">
      <thead class="table-header-glow">
        <tr>
          <th class="ps-4">Title</th>
          <th>Genre</th>
          <th>Watched?</th>
          <th>Year</th>
          <th class="pe-4"></th>
        </tr>
      </thead>
      <tbody>
        @for (movie of movies(); track movie.id) {
        <tr class="movie-row">
          <td class="ps-4 fw-bold">{{ movie.title }}</td>
          <td><span class="genre-badge fw-bold">{{ movie.genreName }}</span></td>
          <td class="text-center align-middle">
            <div class="play-status" [class.watched]="movie.isWatched" [class.unwatched]="!movie.isWatched"
              (click)="toggleWatched(movie)" style="cursor: pointer;">
              <i class="bi play-icon" [class.bi-play-circle-fill]="movie.isWatched"
                [class.bi-play-circle]="!movie.isWatched">
              </i>
              <span class="status-text">{{ movie.isWatched ? 'Seen' : 'Queue' }}</span>
            </div>
          </td>
          <td class="pe-4 fw-bold">{{ movie.watchDate | date:'dd/MM/yyyy' }}</td>
          <td class="pe-4">
            <div class="action-buttons">
              <button class="action-btn edit-btn" title="Edit Movie" (click)="navigateToEdit(movie.id)">
                <i class="bi bi-pencil"></i>
              </button>
              <button class="action-btn delete-btn" title="Delete Movie" (click)="openDeleteModal(movie.id)">
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  }

  @if(showEmptyState()) {
  <div class="empty-state">
    <i class="bi bi-film"></i>
    <p>No movies in our collection yet</p>
  </div>
  }
  }

</div>

<app-confirm-modal #confirmModal [message]="'Are you sure you want to delete this movie? This action cannot be undone.'"
  [title]="'Delete Movie'" (confirm)="confirmDelete()">
</app-confirm-modal>